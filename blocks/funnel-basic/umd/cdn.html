<html>
  <head>
    <script src="//g.alicdn.com/bizcharts/io-asserts/3.1.2/react16.0.0.production.min.js"></script>
    <script src="//g.alicdn.com/bizcharts/io-asserts/3.1.2/react-dom16.0.0.production.min.js"></script>
    <script src="//cdn.bootcss.com/babel-core/5.8.38/browser.min.js"></script>
    <script src="//g.alicdn.com/bizcharts/io-asserts/3.1.5/BizCharts.min.js"> </script>
    <script type="text/javascript" src="//gw.alipayobjects.com/os/antv/assets/data-set/0.8.6/data-set.min.js"></script>
    
    
  </head>
  <body>
      <div id="mountNode" ></div>
      <script type="text/babel">
      const { Chart, Geom, Axis, Tooltip, Coord, Label, Legend, View, Guide, Shape } = window.BizCharts;
      const { Text } = Guide;

      const { DataView } = DataSet;
      let data = [
        { action: '浏览网站', pv: 50000 },
        { action: '放入购物车', pv: 35000 },
        { action: '生成订单', pv: 25000 },
        { action: '支付订单', pv: 15000 },
        { action: '完成交易', pv: 8000 }
      ];
      const dv = new DataView().source(data);
      dv.transform({
        type: 'percent',
        field: 'pv',
        dimension: 'action',
        as: 'percent'
      });
      data = dv.rows;
      const cols = {
        percent: {
          nice: false
        }
      }
      ReactDOM.render((
        <Chart height={window.innerHeight} data={data} scale={cols} padding={[ 20, 120, 95 ]} forceFit>
          <Tooltip showTitle={false} itemTpl='<li data-index={index} style="margin-bottom:4px;"><span style="background-color:{color};" class="g2-tooltip-marker"></span>{name}<br/><span style="padding-left: 16px">浏览人数：{pv}</span><br/><span style="padding-left: 16px">占比：{percent}</span><br/></li>'/>
          <Coord type='rect' transpose scale={[1,-1]} />
          <Legend />
          <Guide >
          {data.map((obj) => {
              return  (
            <Text 
              top={true} 
              position={{
              action: obj.action,
              percent: 'median'}}
              content={parseInt(obj.percent * 100) + '%'}
              style={{
              fill: '#fff',
              fontSize: '12',
              textAlign: 'center',
              shadowBlur: 2,
              shadowColor: 'rgba(0, 0, 0, .45)'}}
            />
            )
          })}
          </Guide>
          <Geom type="intervalSymmetric" position="action*percent" shape='funnel' color={['action', [ '#0050B3', '#1890FF', '#40A9FF', '#69C0FF', '#BAE7FF' ]]}
          tooltip={['action*pv*percent', (action, pv, percent) => {
            return {
              name: action,
              percent: parseInt(percent * 100) + '%',
              pv: pv
            };
          }]} 
            >
          <Label content={['action*pv',(action, pv) => {
            return action + ' ' + pv;
          }]}
          offset={35}
          labeLine={{lineWidth: 1,
              stroke: 'rgba(0, 0, 0, 0.15)'}}
            />
          </Geom>
        </Chart>
      ), document.getElementById("mountNode"));
    </script>
  </body>
</html>
